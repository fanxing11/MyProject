2018/01/21 13:52  讨论结果

- 程序提交。功能性演示与讨论
  1. 数据文件放在C盘
  2. 力角检测和速度检测两个界面合成一个：实时监测界面
      a. 获取地面初始倾角（是否显示/或状态）
      b. 静止检测 ：测量手刹力、XY倾角
      c. 运动检测 ： 脚刹力  脚刹位置 XY倾角 速度 加速度  
  3. 控件做大一些，现在在平板上不好点，比如检测模式选择
  4. 检测模式只保存两种：测试模式、完整检测模式
  5. 用户注册需要管理员权限：点击用户注册之后，需要弹出管理员登录页面，登录成功后再出现用户注册页面

- 对应接口文档方面的改进v1.5
1. Add  获取地面倾角指令，返回地面倾角状态/值的指令
2. modify 
 力角检测/速度检测, 指令名称改成静止检测和运动检测；返回参数需要如上做相应变化
3. del
 检测模式里面的 仅速度、仅力角模式不再使用

- 其他：
1. setup在平板上不能安装
2. 操作的时候有点卡，尤其是界面切换的时候
3. 程序修改意见01.22.docx中关于界面的修改

--------------------
v1.6落实：
- server端：
1. 数据放在C盘
2. 检测模式，只保存两个
3. 用户注册时，*验证管理员*用户的权限，增加一条指令
4. *获地面倾角*的处理：初始存储一个值A， 第一次静态检测时与其相减得到车的相对倾角D，保存D到ini，以后分析时所有角度都减去D得到真实地面倾角
5. 静止检测和运动检测指令的调整
6. 分析指指令的调整

发现的问题：
- 管理员用户登录，如果失败了，没有提示信息（和用户登录的效果一样）
- 现在点击开始/停止获取初始角度的时候，会在发送完开始初始角度命令之后，接着发送一个开始静止检测的指令
- 地面倾角等三种检测模式是有先后顺序的：
1. step1 进入之后，静止和运动采集两个按钮disable，首先点击“获取地面倾角”，一直向上发送数据，并在label为“初始地面倾角”的控件中显示实时地面倾角；点击“停止获取倾角”后弹框“获取地面倾角成功，是否开始进行静止检测？”，确认后显示的地面倾角刻度归零，label变成“地面倾角”，开始step2；点击取消，将恢复刚刚进入step1的状态，可以重新获取地面倾角。
2. step2 只有静止检测enable，开始采集，实时更新地面倾角和手刹力。点击结束后弹框“静态检测结束，是否进行动态检测？”，点击确认开始step3；点击取消将恢复刚刚进入step2的状态，可以重新进行静态检测。
3. step3 只有运动检测enable，开始采集，实时更新数据。点击结束后弹框“静态检测结束，是否结束检测？”，点击确认，本次检测结束，三个按钮都disable；点击取消将恢复刚刚进入step3的状态，可以重新进行动态检测。
- v1.6接口文档：
- 1.新建检测时，还有工程目录参数，接口文档里面没有写
- 2.确认：初始地面倾角、静止检测、运动检测，参数是不是还按照之前定义的扩大100倍传送int？接口文档里面没有写
- 现在server挂掉之后，client端没有通讯中断提示
- 新建测试时，应该判断返回值：如果新建失败，不应改变新建和停止的按钮状态


-----
v 1.7  
1. 改变DAQ方式：数据采集卡变成无线采集方式（通过调用外部dll实现）
2. 保存文件的数据格式暂时不兼容，所以对于CAnalysis和DataController都写了对应的__W函数进行处理。
3. 为了测试sendData2UI，CCommunicator中写了定时发送假数据的代码，默认已经关闭。
4. 增加了系统自检ASQ功能。
5. 改变操作方式：1）界面上不在区分动态与静态检测，2）增加自检，3）保留获取地面倾角+开始/停止检测。内部实现上，为了尽量减少改动，svr端仍然有动态与静态之分；开始后，动态和静态同时开始上数（之前是互斥的）。
v 1.8
1. 标定参数可以通过ini配置；
2. 增加了有线和无线DAQ的集成；config.ini中可以配置有线无线两种方式的参数。
3. 对于目前，后台仍然分动态和静态，由于目前两者是同时发生的，所以在一次采集中XY角度实际上发送了两次。简单的方法：clt端以move发送的数据为准，still的XY不再处理，只处理手刹力即可。
4. 对于脚刹力、角度等为了抑制数据显示的波动，增加了均值滤波。
v 1.8.1
1. 增加了手刹力 脚刹力 及三个加速度 的初始值。后面实际值为采集值减去初始值。

-只有水平面的加速度可以合成，因为他们成90度；而和竖直方向的加速度是不能合成的，不知道与水平面的夹角。
-如果已知了夹角，则可以一试。但三个方向合成后的加速度方向是不一定的。求速度就不能求了。

v1.9
1. 更改了界面上的问题（这里有手刹力和脚刹力的显示，为了防止指针一直波动，只显示5的倍数，5以内的就认为是波动，不再触发指针波动）
2. 加速度只用一个方向：A方向表示。不再使用复合加速度。
3. 手刹力和脚刹力改用中值滤波。其他的仍旧使用均值滤波。
4. 把1.8.1里面的初始值串行化。分析时也需要使用；分析中由于手刹力、坡度有负值，所以取绝对值最大值显示。脚踏板在分析时候显示最大值和最小值的差值。

v1.9.1
1. 重构了部分analysis的代码，解析文件数据之前有错误
2. 尝试了更多的排序算法
3. 目前排序还有问题。可能是暂时性的。
4. client暂时的问题：分析功能的坡度，client端弄反了。目前换了svr端；后面需要改过来。
5. client 如果分析失败。一次检测完毕后，不能继续下一次检测？

v1.9.2 0622
1. 重新定义以及计算了acc vel dist的值。但目前来看，vel似乎大了10倍，dist似乎大了100倍。不知道为什么。
2. 界面上的修改（20180621.doc）
3. 由于加速度对倾角有影响，为了解决动态测量时的数据波动问题，发送模拟假数据，在初始倾角的基础上加了一个%0.2的随机波动。
v1.9.2.1
1. 所有的分析结果，显示绝对值，不再有正负之分。
2. tmp：现在分析结果中的速度乘了十倍，距离乘了100倍。暂时缩小了一定的倍数（CAnalysis::HandleDataW）。实时监测里面的速度也需要缩小10倍。（注释tmp1.9.2.1）
v1.9.3
1. 乘以10倍不用了，现在是加速度para，config.ini参数乘了10倍ok
2. 初始倾角时，界面不更新倾角（1.9.6client改正）
3. 分析失败，界面上不显示原因

v1.9.4 现场测试返回的信息
1. 踏板行程config第一个参数扩大10倍，以便显示mm值。相应的，界面上显示单位是mm
2. 分析功能里面的踏板行程最大值最小值计算方法变化，采用与实时监测里面的一样的取均值方法。
3. 去掉 v1.9.3里面参数乘以10倍的方法，config里面仍然参数变成原来的参数。
4. 实时监测里面的速度值也才上面的乘以10的方法。
5. 去掉 v1.9.2里面随机波动

v1.9.5 现场测试返回信息二
1. 现在速度比较准了，config里面的vel参数改了。
2. 倾角、驻车制动力，需要在初始检测时进行测量。（需要把still自movedetect中移动到init中）
3. 脚刹距离分析里面计算得不准。ok

v1.9.5.1
制动距离，不要自最大速度开始算，因为中间还有一个匀速的过程；而应该在制动力开始增加的时候进行计算。（初始制动速度、制动加速度应该影响不大：还是按照最大速度点作为参考。这个方案计算出来的偏大，因为中间可能有匀速过程）

client改。历史曲线数据，500个发送一次，每次发送的点之间的时间间隔是500*(1/2000)=0.25s

v1.9.6
默认存储路径改到D盘。
制动距离重新计算：增加ValidFootBrakeForce，在分析时，当脚刹力增加到这个值之后，就认为踩下刹车了，之后的过程都是刹车过程，从而累加计算刹车路程。
v1.9.6.1
刹车部分：手刹力去掉了初始值（由于v1.9.5-2 中点击初始检测，就同时开始了之前的初始检测和静态检测，同时在更新手刹力和初始手刹力，两者之差肯定是0，所以这里计算手刹力的时候不再减去初始值。）隐藏的问题：初始归零没有了，可以通过设置参数归零，否则得到的最大手刹力是不准的。
v1.9.6.2
- 修改了.1中初始手刹力的问题并更改了手刹力更新时机。
- 实时监测中初始脚刹力波动，改了间隔采点为连续采点后去中位数方法，效果明显。（手刹力由于没有报问题，故仍沿用之前的间隔采点方式。）
- 修复了v1.9.6中Filter计算的bug
- 更新了config.ini